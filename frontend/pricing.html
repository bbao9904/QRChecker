<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>NÃ¢ng cáº¥p Premium - QR Checker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Quicksand:400,600,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <style>
    .pricing-card.current-plan {
      border: 3px solid #28a745;
      position: relative;
      padding-bottom: 50px; /* ThÃªm padding Ä‘á»ƒ chá»©a badge */
    }
    .pricing-card.current-plan::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(40, 167, 69, 0.05);
      pointer-events: none;
      border-radius: inherit;
    }
    .current-plan-badge {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(40, 167, 69, 0.4);
      z-index: 1;
    }
    .pricing-card.current-plan .pricing-header {
      background: linear-gradient(135deg, #28a745, #20c997) !important;
    }
    
    /* Chá»¯ tráº¯ng cho gÃ³i miá»…n phÃ­ khi lÃ  gÃ³i hiá»‡n táº¡i */
    .pricing-card.current-plan .pricing-header.free h3,
    .pricing-card.current-plan .pricing-header.free .pricing-price {
      color: white !important;
    }
    
    /* Äáº£m báº£o pricing-grid cÃ³ overflow visible */
    .pricing-grid {
      overflow: visible;
    }
    
    /* Thu nhá» badge Phá»• biáº¿n vÃ  Tiáº¿t kiá»‡m nháº¥t */
    .pricing-badge {
      font-size: 9px;
      padding: 4px 10px;
    }
  </style>
</head>
<body>
<header class="site-header">
  <nav class="nav">
    <div class="nav__brand">
      <a href="index.html" class="nav__logo">
        <img src="assets/qr-checker-logo.png" alt="QR Checker" class="nav__logo-img">
      </a>
      <span class="nav__title">QR Checker</span>
    </div>
    <input type="checkbox" id="nav-toggle">
    <label for="nav-toggle" class="nav__toggle"><span></span></label>
    <div class="nav__links">
      <a href="about.html">Giá»›i thiá»‡u</a>
      <a href="guide.html">HÆ°á»›ng dáº«n</a>
      <a href="create.html">Táº¡o mÃ£ QR</a>
      <a href="history.html">Lá»‹ch sá»­</a>
      <a id="nav-auth" class="btn-small" href="login.html">ÄÄƒng nháº­p</a>
    </div>
  </nav>
</header>

<section class="scan-wrapper" style="padding-top:40px;">
  <h1 class="section-title">NÃ¢ng cáº¥p Premium</h1>
  
  <!-- Current Status -->
  <div id="current-status" class="card" style="max-width:800px;margin:0 auto 40px;">
    <div class="loading"><div class="spinner"></div><span>Äang táº£i...</span></div>
  </div>
  
  <!-- Pricing Cards -->
  <div class="pricing-grid">
    <!-- Free Plan -->
    <div class="pricing-card" data-plan="free">
      <div class="pricing-header free">
        <h3>Miá»…n phÃ­</h3>
        <div class="pricing-price">0Ä‘</div>
      </div>
      <div class="pricing-body">
        <ul class="pricing-features">
          <li>âœ… QuÃ©t mÃ£ QR: <strong>5 láº§n</strong></li>
          <li>âŒ Táº¡o mÃ£ QR</li>
          <li>âŒ Xem lá»‹ch sá»­</li>
        </ul>
      </div>
    </div>
    
    <!-- 1 Month -->
    <div class="pricing-card" data-plan="1_month">
      <div class="pricing-header monthly">
        <h3>GÃ³i 1 thÃ¡ng</h3>
        <div class="pricing-price">30,000Ä‘</div>
      </div>
      <div class="pricing-body">
        <ul class="pricing-features">
          <li>âœ… QuÃ©t mÃ£ QR: <strong>KhÃ´ng giá»›i háº¡n</strong></li>
          <li>âœ… Táº¡o mÃ£ QR: <strong>KhÃ´ng giá»›i háº¡n</strong></li>
          <li>âœ… Xem lá»‹ch sá»­ Ä‘áº§y Ä‘á»§</li>
          <li>âœ… Há»— trá»£ Æ°u tiÃªn</li>
        </ul>
      </div>
    </div>
    
    <!-- 3 Months -->
    <div class="pricing-card featured" data-plan="3_months">
      <div class="pricing-badge">Phá»• biáº¿n</div>
      <div class="pricing-header monthly">
        <h3>GÃ³i 3 thÃ¡ng</h3>
        <div class="pricing-price">80,000Ä‘</div>
        <div class="pricing-save">Tiáº¿t kiá»‡m 10,000Ä‘</div>
      </div>
      <div class="pricing-body">
        <ul class="pricing-features">
          <li>âœ… QuÃ©t mÃ£ QR: <strong>KhÃ´ng giá»›i háº¡n</strong></li>
          <li>âœ… Táº¡o mÃ£ QR: <strong>KhÃ´ng giá»›i háº¡n</strong></li>
          <li>âœ… Xem lá»‹ch sá»­ Ä‘áº§y Ä‘á»§</li>
          <li>âœ… Há»— trá»£ Æ°u tiÃªn</li>
        </ul>
      </div>
    </div>
    
    <!-- 6 Months -->
    <div class="pricing-card" data-plan="6_months">
      <div class="pricing-header yearly">
        <h3>GÃ³i 6 thÃ¡ng</h3>
        <div class="pricing-price">150,000Ä‘</div>
        <div class="pricing-save">Tiáº¿t kiá»‡m 30,000Ä‘</div>
      </div>
      <div class="pricing-body">
        <ul class="pricing-features">
          <li>âœ… QuÃ©t mÃ£ QR: <strong>KhÃ´ng giá»›i háº¡n</strong></li>
          <li>âœ… Táº¡o mÃ£ QR: <strong>KhÃ´ng giá»›i háº¡n</strong></li>
          <li>âœ… Xem lá»‹ch sá»­ Ä‘áº§y Ä‘á»§</li>
          <li>âœ… Há»— trá»£ Æ°u tiÃªn</li>
        </ul>
      </div>
    </div>
    
    <!-- 1 Year -->
    <div class="pricing-card" data-plan="1_year">
      <div class="pricing-badge best">Tiáº¿t kiá»‡m nháº¥t</div>
      <div class="pricing-header yearly">
        <h3>GÃ³i 1 nÄƒm</h3>
        <div class="pricing-price">280,000Ä‘</div>
        <div class="pricing-save">Tiáº¿t kiá»‡m 80,000Ä‘</div>
      </div>
      <div class="pricing-body">
        <ul class="pricing-features">
          <li>âœ… QuÃ©t mÃ£ QR: <strong>KhÃ´ng giá»›i háº¡n</strong></li>
          <li>âœ… Táº¡o mÃ£ QR: <strong>KhÃ´ng giá»›i háº¡n</strong></li>
          <li>âœ… Xem lá»‹ch sá»­ Ä‘áº§y Ä‘á»§</li>
          <li>âœ… Há»— trá»£ Æ°u tiÃªn</li>
          <li>ğŸ <strong>Táº·ng 2 thÃ¡ng miá»…n phÃ­</strong></li>
        </ul>
      </div>
    </div>
  </div>
  
  <!-- Contact Section -->
  <div class="card contact-card" style="max-width:800px;margin:40px auto 0;">
    <h2 style="text-align:center; margin-bottom: 20px;">ğŸ“ LiÃªn há»‡ mua gÃ³i</h2>
    
    <div class="contact-info">
      <div class="contact-item">
        <div class="contact-icon">ğŸ“±</div>
        <div class="contact-details">
          <h4>Sá»‘ Ä‘iá»‡n thoáº¡i / Zalo</h4>
          <a href="tel:0829046031" class="contact-link">0829 046 031</a>
        </div>
      </div>
      
      <div class="contact-item">
        <div class="contact-icon">ğŸ‘¤</div>
        <div class="contact-details">
          <h4>LiÃªn há»‡</h4>
          <p><strong>Huá»³nh Báº£o</strong></p>
        </div>
      </div>
    </div>
    
    <div class="purchase-steps">
      <h4>ğŸ“‹ HÆ°á»›ng dáº«n mua gÃ³i:</h4>
      <ol>
        <li><strong>BÆ°á»›c 1:</strong> Chá»n gÃ³i phÃ¹ há»£p vá»›i nhu cáº§u</li>
        <li><strong>BÆ°á»›c 2:</strong> LiÃªn há»‡ qua sá»‘ Ä‘iá»‡n thoáº¡i/Zalo: <strong>0829 046 031</strong></li>
        <li><strong>BÆ°á»›c 3:</strong> Cung cáº¥p <strong>tÃªn tÃ i khoáº£n</strong> vÃ  <strong>gÃ³i muá»‘n mua</strong></li>
        <li><strong>BÆ°á»›c 4:</strong> Chuyá»ƒn khoáº£n theo hÆ°á»›ng dáº«n</li>
        <li><strong>BÆ°á»›c 5:</strong> GÃ³i sáº½ Ä‘Æ°á»£c kÃ­ch hoáº¡t trong vÃ²ng <strong>15 phÃºt</strong> sau khi xÃ¡c nháº­n thanh toÃ¡n</li>
      </ol>
    </div>
    
    <div class="payment-note">
      <p>ğŸ’¡ <strong>LÆ°u Ã½:</strong> Vui lÃ²ng cung cáº¥p Ä‘Ãºng tÃªn tÃ i khoáº£n Ä‘Ã£ Ä‘Äƒng kÃ½ trÃªn QR Checker Ä‘á»ƒ Ä‘Æ°á»£c kÃ­ch hoáº¡t chÃ­nh xÃ¡c.</p>
    </div>
  </div>
</section>

<footer class="site-footer">
  <div class="footer-grid">
    <div>
      <h4>QR Checker</h4>
      <p class="small">Ná»n táº£ng kiá»ƒm tra & táº¡o QR an toÃ n.</p>
    </div>
    <div>
      <h5>Chá»©c nÄƒng</h5>
      <ul>
        <li><a href="index.html#scan">QuÃ©t mÃ£ QR</a></li>
        <li><a href="create.html">Táº¡o mÃ£</a></li>
        <li><a href="history.html">Lá»‹ch sá»­</a></li>
      </ul>
    </div>
    <div>
      <h5>Há»— trá»£</h5>
      <ul>
        <li><a href="guide.html">HÆ°á»›ng dáº«n</a></li>
        <li><a href="about.html">Giá»›i thiá»‡u</a></li>
      </ul>
    </div>
  </div>
  <div class="copy small">Â© 2025 QR Checker</div>
</footer>

<script>
// Auth check
(async function(){
  const a = document.getElementById('nav-auth');
  const r = await fetch('/me', {credentials:'include'}).catch(()=>null);
  const authed = !!r && r.status === 200;

  if(a){
    if(authed){ a.textContent='TÃ i khoáº£n'; a.href='account.html'; }
    else{ a.textContent='ÄÄƒng nháº­p'; a.href='login.html?next=pricing.html'; }
  }
  
  if(authed){
    loadStatus();
  } else {
    document.getElementById('current-status').innerHTML = `
      <p style="text-align:center;">Vui lÃ²ng <a href="login.html?next=pricing.html">Ä‘Äƒng nháº­p</a> Ä‘á»ƒ xem tráº¡ng thÃ¡i tÃ i khoáº£n.</p>
    `;
  }
})();

// Map plan_id to data-plan attribute
function getPlanDataAttr(planId) {
  const mapping = {
    '1_month': '1_month',
    '3_months': '3_months', 
    '6_months': '6_months',
    '1_year': '1_year'
  };
  return mapping[planId] || null;
}

function highlightCurrentPlan(planId) {
  // Remove current-plan class from all cards
  document.querySelectorAll('.pricing-card').forEach(card => {
    card.classList.remove('current-plan');
    // Remove existing current-plan-badge if any
    const existingBadge = card.querySelector('.current-plan-badge');
    if (existingBadge) existingBadge.remove();
  });
  
  // If no subscription (free user), highlight free plan
  if (!planId) {
    const freeCard = document.querySelector('.pricing-card[data-plan="free"]');
    if (freeCard) {
      freeCard.classList.add('current-plan');
      const badge = document.createElement('div');
      badge.className = 'current-plan-badge';
      badge.textContent = 'âœ“ GÃ³i hiá»‡n táº¡i cá»§a báº¡n';
      freeCard.appendChild(badge);
    }
    return;
  }
  
  // Find and highlight the current plan card
  const planAttr = getPlanDataAttr(planId);
  if (planAttr) {
    const card = document.querySelector(`.pricing-card[data-plan="${planAttr}"]`);
    if (card) {
      card.classList.add('current-plan');
      const badge = document.createElement('div');
      badge.className = 'current-plan-badge';
      badge.textContent = 'âœ“ GÃ³i hiá»‡n táº¡i cá»§a báº¡n';
      card.appendChild(badge);
    }
  }
}

async function loadStatus() {
  const statusDiv = document.getElementById('current-status');
  
  try {
    const response = await fetch('/subscription/info', { credentials: 'include' });
    const data = await response.json();
    
    if (data.status === 'ok') {
      if (data.is_admin) {
        statusDiv.innerHTML = `
          <div style="text-align:center;">
            <h3>ğŸ‘‘ TÃ i khoáº£n Quáº£n trá»‹ viÃªn</h3>
            <p>Báº¡n cÃ³ quyá»n truy cáº­p Ä‘áº§y Ä‘á»§ táº¥t cáº£ tÃ­nh nÄƒng.</p>
          </div>
        `;
      } else if (data.has_subscription) {
        const endDate = new Date(data.end_date).toLocaleDateString('vi-VN');
        
        statusDiv.innerHTML = `
          <div style="text-align:center;">
            <h3>âœ… TÃ i khoáº£n Premium - ${data.plan_name}</h3>
            <p><strong>Háº¿t háº¡n:</strong> ${endDate}</p>
            <p class="small" style="margin-top:8px; color: #28a745;">Báº¡n Ä‘ang sá»­ dá»¥ng Ä‘áº§y Ä‘á»§ tÃ­nh nÄƒng Premium.</p>
            <p class="small" style="margin-top:12px; color: #666;">ğŸ’¡ Báº¡n cÃ³ thá»ƒ gia háº¡n hoáº·c nÃ¢ng cáº¥p gÃ³i báº±ng cÃ¡ch liÃªn há»‡ bÃªn dÆ°á»›i.</p>
          </div>
        `;
        
        // Highlight current plan
        highlightCurrentPlan(data.plan_id);
      } else {
        statusDiv.innerHTML = `
          <div style="text-align:center;">
            <h3>ğŸ“± TÃ i khoáº£n Miá»…n phÃ­</h3>
            <p><strong>LÆ°á»£t quÃ©t cÃ²n láº¡i:</strong> ${data.free_scans_remaining}/${data.free_scan_limit}</p>
            <p class="small" style="margin-top:8px; color: #ff6600;">â¬‡ï¸ Chá»n gÃ³i bÃªn dÆ°á»›i vÃ  liÃªn há»‡ Ä‘á»ƒ nÃ¢ng cáº¥p!</p>
          </div>
        `;
        
        // Highlight free plan
        highlightCurrentPlan(null);
      }
    }
  } catch (error) {
    statusDiv.innerHTML = '<p class="error-message">âŒ KhÃ´ng thá»ƒ táº£i thÃ´ng tin</p>';
  }
}
</script>
</body>
</html>