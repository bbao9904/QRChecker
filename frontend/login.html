<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ÄÄƒng nháº­p - QR Checker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Quicksand:400,600,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
<header class="site-header">
  <nav class="nav">
    <div class="nav__brand">
      <a href="index.html" class="nav__logo">
        <img src="assets/qr-checker-logo.png" alt="QR Checker" class="nav__logo-img">
      </a>
      <span class="nav__title">QR Checker</span>
    </div>
    <input type="checkbox" id="nav-toggle">
    <label for="nav-toggle" class="nav__toggle"><span></span></label>
    <div class="nav__links">
      <a href="about.html">Giá»›i thiá»‡u</a>
      <a href="guide.html">HÆ°á»›ng dáº«n</a>
      <a href="create.html">Táº¡o mÃ£ QR</a>
      <a href="history.html">Lá»‹ch sá»­</a>
      <a id="nav-auth" class="btn-small" href="login.html">ÄÄƒng nháº­p</a>
    </div>
  </nav>
</header>

<section class="scan-wrapper" style="padding-top:40px;">
  <div class="card auth-card">
    <h2>ÄÄƒng nháº­p</h2>
    <form id="login-form" class="form" autocomplete="on">
      <input id="login-username" name="username" placeholder="TÃªn Ä‘Äƒng nháº­p" autocomplete="username" required>
      <div class="input-wrap">
        <input id="login-password" class="input-with-icon" name="password" type="password" placeholder="Máº­t kháº©u" autocomplete="current-password" required>
        <button type="button" class="toggle-eye" aria-label="Hiá»‡n/áº©n máº­t kháº©u" data-target="login-password">ğŸ‘</button>
      </div>
      <button type="submit" class="btn btn--primary full mt-1">ÄÄƒng nháº­p</button>
      <div id="login-msg" class="small msg error" aria-live="polite"></div>
      <div class="small" style="margin-top:10px;color:#666;">ChÆ°a cÃ³ tÃ i khoáº£n? <a href="register.html">ÄÄƒng kÃ½</a></div>
    </form>
  </div>
</section>

<footer class="site-footer">
  <div class="footer-grid">
    <div>
      <h4>QR Checker</h4>
      <p class="small">Ná»n táº£ng kiá»ƒm tra & táº¡o QR an toÃ n.</p>
    </div>
    <div>
      <h5>Chá»©c nÄƒng</h5>
      <ul>
        <li><a href="#scan">QuÃ©t mÃ£ QR</a></li>
        <li><a href="create.html">Táº¡o mÃ£</a></li>
        <li><a href="history.html">Lá»‹ch sá»­</a></li>
      </ul>
    </div>
    <div>
      <h5>Há»— trá»£</h5>
      <ul>
        <li><a href="guide.html">HÆ°á»›ng dáº«n</a></li>
        <li><a href="about.html">Giá»›i thiá»‡u</a></li>
      </ul>
    </div>
  </div>
  <div class="copy small">Â© 2025 QR Checker</div>
</footer>

<script>
const nextUrl = new URLSearchParams(location.search).get('next') || 'index.html';

// Toggle eye
document.querySelectorAll('.toggle-eye').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const id = btn.getAttribute('data-target');
    const input = document.getElementById(id);
    if(!input) return;
    input.type = input.type === 'password' ? 'text' : 'password';
  });
});

// Submit (Enter há»— trá»£ sáºµn)
document.getElementById('login-form').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const username = document.getElementById('login-username').value.trim();
  const password = document.getElementById('login-password').value;
  const r = await fetch('/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});
  if(r.status===200){ location.href = nextUrl; }
  else{
    const d = await r.json().catch(()=>({}));
    document.getElementById('login-msg').textContent = d.msg || 'ÄÄƒng nháº­p tháº¥t báº¡i';
  }
});

// Navbar auth label/link
(async function(){
  const a = document.getElementById('nav-auth'); if(!a) return;
  try{
    const r = await fetch('/me');
    if(r.status===200){ a.textContent='TÃ i khoáº£n'; a.href='account.html'; }
    else{ a.textContent='ÄÄƒng nháº­p'; a.href='login.html?next=' + encodeURIComponent(location.pathname); }
  }catch{ a.textContent='ÄÄƒng nháº­p'; a.href='login.html?next=' + encodeURIComponent(location.pathname); }
})();
</script>
</body>
</html>