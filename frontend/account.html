<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>TÃ i khoáº£n - QR Checker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Quicksand:400,600,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
<header class="site-header">
  <nav class="nav">
    <div class="nav__brand">
      <a href="index.html" class="nav__logo">
        <img src="assets/qr-checker-logo.png" alt="QR Checker" class="nav__logo-img">
      </a>
      <span class="nav__title">QR Checker</span>
    </div>
    <input type="checkbox" id="nav-toggle">
    <label for="nav-toggle" class="nav__toggle"><span></span></label>
    <div class="nav__links">
      <a href="about.html">Giá»›i thiá»‡u</a>
      <a href="guide.html">HÆ°á»›ng dáº«n</a>
      <a href="create.html">Táº¡o mÃ£ QR</a>
      <a href="history.html">Lá»‹ch sá»­</a>
      <a id="nav-auth" class="btn-small" href="account.html">TÃ i khoáº£n</a>
    </div>
  </nav>
</header>

<section class="scan-wrapper" style="padding-top:40px;">
  <div id="guard" class="card" style="max-width:600px;margin:0 auto;display:none;text-align:center;">
    <h3>Báº¡n cáº§n Ä‘Äƒng nháº­p Ä‘á»ƒ xem trang nÃ y</h3>
    <p style="margin:8px 0 16px;color:#555;">Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ tiáº¿p tá»¥c.</p>
    <a class="btn btn--primary" id="btnLogin">ÄÄƒng nháº­p</a>
    <a class="btn btn--ghost" href="register.html" style="margin-left:8px;">ÄÄƒng kÃ½</a>
  </div>

  <div id="authed" class="card" style="max-width:700px;margin:0 auto;display:none;">
    <h2>ThÃ´ng tin tÃ i khoáº£n</h2>
    <div id="user-info">Äang táº£i...</div>
    
    <!-- Subscription Section -->
    <div id="subscription-section" style="margin-top: 24px; padding-top: 24px; border-top: 2px solid #f0f0f0;">
      <h3>ğŸ“¦ GÃ³i dá»‹ch vá»¥</h3>
      <div id="subscription-info">Äang táº£i...</div>
    </div>
  </div>
</section>

<footer class="site-footer">
  <div class="footer-grid">
    <div>
      <h4>QR Checker</h4>
      <p class="small">Ná»n táº£ng kiá»ƒm tra & táº¡o QR an toÃ n.</p>
    </div>
    <div>
      <h5>Chá»©c nÄƒng</h5>
      <ul>
        <li><a href="#scan">QuÃ©t mÃ£ QR</a></li>
        <li><a href="create.html">Táº¡o mÃ£</a></li>
        <li><a href="history.html">Lá»‹ch sá»­</a></li>
      </ul>
    </div>
    <div>
      <h5>Há»— trá»£</h5>
      <ul>
        <li><a href="guide.html">HÆ°á»›ng dáº«n</a></li>
        <li><a href="about.html">Giá»›i thiá»‡u</a></li>
        <li><a href="privacy.html">ChÃ­nh sÃ¡ch báº£o máº­t</a></li>
      </ul>
    </div>
  </div>
  <div class="copy small">Â© 2025 QR Checker</div>
</footer>

<script>
(async ()=>{
  const r = await fetch('/me');
  const isAuthed = r.status===200;
  document.getElementById('guard').style.display = isAuthed ? 'none' : 'block';
  document.getElementById('authed').style.display = isAuthed ? 'block' : 'none';
  document.getElementById('btnLogin')?.addEventListener('click', ()=>{
    location.href = 'login.html?next=' + encodeURIComponent('account.html');
  });
  
  if(isAuthed){
    const me = await r.json();
    document.getElementById('user-info').innerHTML = `
      <div class="kv"><span>TÃ i khoáº£n</span><code>${me.username}</code></div>
      <div class="kv"><span>Quyá»n</span><code>${me.is_admin? 'ğŸ‘‘ Admin':'User'}</code></div>
      <div style="margin-top:16px; display: flex; gap: 8px; flex-wrap: wrap;">
        <button class="btn btn--outline" onclick="logout()">ÄÄƒng xuáº¥t</button>
        ${me.is_admin ? '<a class="btn btn--accent" href="admin.html">Trang quáº£n trá»‹</a>' : ''}
      </div>
    `;
    
    // Load subscription info
    await loadSubscriptionInfo(me.is_admin);
  }
})();

async function loadSubscriptionInfo(isAdmin) {
  const subDiv = document.getElementById('subscription-info');
  
  if (isAdmin) {
    subDiv.innerHTML = `
      <div class="sub-status admin">
        <div class="sub-icon">ğŸ‘‘</div>
        <div class="sub-details">
          <h4>Quáº£n trá»‹ viÃªn</h4>
          <p>Báº¡n cÃ³ quyá»n truy cáº­p Ä‘áº§y Ä‘á»§ táº¥t cáº£ tÃ­nh nÄƒng.</p>
        </div>
      </div>
    `;
    return;
  }
  
  try {
    const response = await fetch('/subscription/info', { credentials: 'include' });
    const data = await response.json();
    
    if (data.status === 'ok') {
      if (data.has_subscription) {
        const endDate = new Date(data.end_date).toLocaleDateString('vi-VN');
        subDiv.innerHTML = `
          <div class="sub-status premium">
            <div class="sub-icon">â­</div>
            <div class="sub-details">
              <h4>Premium - ${data.plan_name}</h4>
              <p>Háº¿t háº¡n: <strong>${endDate}</strong></p>
              <p class="small" style="color: #fff;">âœ… KhÃ´ng giá»›i háº¡n quÃ©t & táº¡o mÃ£ QR</p>
            </div>
          </div>
          
          <div style="margin-top: 20px;">
            <a href="pricing.html" class="btn btn--outline">ğŸ”„ Gia háº¡n / NÃ¢ng cáº¥p gÃ³i</a>
          </div>
        `;
      } else {
        subDiv.innerHTML = `
          <div class="sub-status free">
            <div class="sub-icon">ğŸ“±</div>
            <div class="sub-details">
              <h4>GÃ³i Miá»…n phÃ­</h4>
              <p>LÆ°á»£t quÃ©t cÃ²n láº¡i: <strong>${data.free_scans_remaining}/${data.free_scan_limit}</strong></p>
              <p class="small" style="color: #666;">NÃ¢ng cáº¥p Premium Ä‘á»ƒ sá»­ dá»¥ng khÃ´ng giá»›i háº¡n!</p>
            </div>
          </div>
          
          <div style="margin-top: 20px;">
            <a href="pricing.html" class="btn btn--primary">ğŸš€ NÃ¢ng cáº¥p Premium</a>
          </div>
        `;
      }
    }
  } catch (error) {
    subDiv.innerHTML = '<p class="error-message">âŒ KhÃ´ng thá»ƒ táº£i thÃ´ng tin</p>';
  }
}

async function logout(){ await fetch('/logout'); location.href='login.html'; }

// Navbar auth label/link
(async function(){
  const a = document.getElementById('nav-auth'); if(!a) return;
  try{
    const r = await fetch('/me');
    if(r.status===200){ a.textContent='TÃ i khoáº£n'; a.href='account.html'; }
    else{
      a.textContent='ÄÄƒng nháº­p';
      a.href='login.html?next=' + encodeURIComponent(location.pathname);
    }
  }catch{
    a.textContent='ÄÄƒng nháº­p';
    a.href='login.html?next=' + encodeURIComponent(location.pathname);
  }
})();
</script>
</body>
</html>